<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráfico de Rehabilitación de Vía PC-RE</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #plot {
            width: 90%;
            margin: auto;
        }
    </style>
</head>
<body>
    <h1>Gráfico de Rehabilitación de Vía PC-RE</h1>
    <div id="plot"></div>
    
    <script>
        async function loadData(url) {
            const response = await fetch(url);
            return await response.json();
        }

        async function drawPlot() {
            // Cargar los datos desde los archivos JSON en GitHub
            const resumData = await loadData('https://raw.githubusercontent.com/tu_usuario/tu_repositorio/main/resum.json');
            const estacionsData = await loadData('https://raw.githubusercontent.com/tu_usuario/tu_repositorio/main/estacions.json');

            // Filtrar los datos específicos para el tramo PC-RE
            const via1 = resumData.filter(d => d.Via === 1 && d.TRAM === 'PC-RE');
            const via2 = resumData.filter(d => d.Via === 2 && d.TRAM === 'PC-RE');
            const estacions = estacionsData.filter(d => d.Tram === 'PC-RE');

            // Preparar datos para los ejes y gráficos de rehabilitación
            const pkIniciVia1 = via1.map(d => (d['PK inici'] + d['PK final']) / 2);
            const pkFinalVia1 = via1.map(d => d['PK final'] - d['PK inici']);
            const anyPrevVia1 = via1.map(d => d['PREVISIÓ REHABILITACIÓ']);

            const pkIniciVia2 = via2.map(d => (d['PK inici'] + d['PK final']) / 2);
            const pkFinalVia2 = via2.map(d => d['PK final'] - d['PK inici']);
            const anyPrevVia2 = via2.map(d => d['PREVISIÓ REHABILITACIÓ']);

            // Configuración de colores según el año de rehabilitación
            const minYear = 2000;
            const maxYear = 2065;
            const colorScale = any => {
                const normValue = (any - minYear) / (maxYear - minYear);
                return `rgba(${255 * (1 - normValue)}, ${255 * normValue}, 0, 1)`;
            };

            // Datos de la gráfica
            const traces = [
                {
                    x: anyPrevVia1,
                    y: pkIniciVia1,
                    type: 'bar',
                    orientation: 'h',
                    width: 0.5,
                    marker: {
                        color: anyPrevVia1.map(colorScale)
                    },
                    name: 'Vía 1'
                },
                {
                    x: anyPrevVia2,
                    y: pkIniciVia2,
                    type: 'bar',
                    orientation: 'h',
                    width: 0.5,
                    marker: {
                        color: anyPrevVia2.map(colorScale)
                    },
                    name: 'Vía 2'
                }
            ];

            // Configuración de la gráfica
            const layout = {
                title: 'Espai-temps previsió rehabilitació via 1 i 2 PC-RE',
                xaxis: {
                    title: 'Any previsió rehabilitació',
                    tickangle: 45,
                    tickvals: Array.from({ length: maxYear - minYear + 1 }, (_, i) => minYear + i),
                    ticktext: Array.from({ length: maxYear - minYear + 1 }, (_, i) => minYear + i)
                },
                yaxis: {
                    title: 'PK',
                    autorange: 'reversed'
                },
                barmode: 'stack'
            };

            // Dibujar la gráfica
            Plotly.newPlot('plot', traces, layout);
        }

        // Dibujar la gráfica al cargar la página
        drawPlot();
    </script>
</body>
</html>
